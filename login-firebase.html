<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ÄÄƒng nháº­p vÃ o AI Smart To-Do List">
    <title>ÄÄƒng Nháº­p - AI Smart To-Do List</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="login-container">
        <div class="login-card glass-card">
            <div class="login-header">
                <h1>ğŸ¤– AI Smart To-Do List</h1>
                <p>Quáº£n lÃ½ cÃ´ng viá»‡c thÃ´ng minh vá»›i AI</p>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="auth-form">
                <h2>ÄÄƒng Nháº­p</h2>
                <form id="loginFormElement">
                    <div class="input-wrapper">
                        <label for="loginUsername">TÃªn Ä‘Äƒng nháº­p</label>
                        <input type="text" id="loginUsername" class="task-input" placeholder="Nháº­p tÃªn Ä‘Äƒng nháº­p"
                            required autocomplete="username">
                    </div>

                    <div class="input-wrapper">
                        <label for="loginPassword">Máº­t kháº©u</label>
                        <input type="password" id="loginPassword" class="task-input" placeholder=" Nháº­p máº­t kháº©u"
                            required autocomplete="current-password">
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">
                        ğŸ”“ ÄÄƒng Nháº­p
                    </button>
                </form>

                <div class="auth-switch">
                    <p>ChÆ°a cÃ³ tÃ i khoáº£n? <a href="#" id="showRegister">ÄÄƒng kÃ½ ngay</a></p>
                </div>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="auth-form hidden">
                <h2>ÄÄƒng KÃ½ TÃ i Khoáº£n</h2>
                <form id="registerFormElement">
                    <div class="input-wrapper">
                        <label for="registerFullName">Há» vÃ  tÃªn</label>
                        <input type="text" id="registerFullName" class="task-input" placeholder="Nháº­p há» vÃ  tÃªn"
                            required>
                    </div>

                    <div class="input-wrapper">
                        <label for="registerUsername">TÃªn Ä‘Äƒng nháº­p</label>
                        <input type="text" id="registerUsername" class="task-input"
                            placeholder="Nháº­p tÃªn Ä‘Äƒng nháº­p (tá»‘i thiá»ƒu 3 kÃ½ tá»±)" required autocomplete="username">
                    </div>

                    <div class="input-wrapper">
                        <label for="registerPassword">Máº­t kháº©u</label>
                        <input type="password" id="registerPassword" class="task-input"
                            placeholder="Nháº­p máº­t kháº©u (tá»‘i thiá»ƒu 6 kÃ½ tá»±)" required autocomplete="new-password">
                    </div>

                    <div class="input-wrapper">
                        <label for="registerPasswordConfirm">XÃ¡c nháº­n máº­t kháº©u</label>
                        <input type="password" id="registerPasswordConfirm" class="task-input"
                            placeholder="Nháº­p láº¡i máº­t kháº©u" required autocomplete="new-password">
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">
                        âœ¨ ÄÄƒng KÃ½
                    </button>
                </form>

                <div class="auth-switch">
                    <p>ÄÃ£ cÃ³ tÃ i khoáº£n? <a href="#" id="showLogin">ÄÄƒng nháº­p</a></p>
                </div>
            </div>

            <!-- Message Display -->
            <div id="authMessage" class="auth-message hidden"></div>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script type="module">
        import authService from './firebase-auth.js';

        // Check if already logged in
        (async () => {
            await authService.waitForAuth();

            if (authService.isLoggedIn()) {
                const user = authService.getCurrentUser();
                if (user && user.role === 'admin') {
                    window.location.href = 'admin.html';
                } else {
                    window.location.href = 'index.html';
                }
            }
        })();

        // Form switching
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const showRegisterBtn = document.getElementById('showRegister');
        const showLoginBtn = document.getElementById('showLogin');

        showRegisterBtn.addEventListener('click', (e) => {
            e.preventDefault();
            loginForm.classList.add('hidden');
            registerForm.classList.remove('hidden');
            clearMessage();
        });

        showLoginBtn.addEventListener('click', (e) => {
            e.preventDefault();
            registerForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
            clearMessage();
        });

        // Login form submission
        document.getElementById('loginFormElement').addEventListener('submit', async (e) => {
            e.preventDefault();

            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            const result = await authService.login(username, password);

            if (result.success) {
                showMessage(result.message, 'success');
                setTimeout(() => {
                    if (result.user.role === 'admin') {
                        window.location.href = 'admin.html';
                    } else {
                        window.location.href = 'index.html';
                    }
                }, 500);
            } else {
                showMessage(result.message, 'error');
            }
        });

        // Register form submission
        document.getElementById('registerFormElement').addEventListener('submit', async (e) => {
            e.preventDefault();

            const fullName = document.getElementById('registerFullName').value;
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;

            if (password !== passwordConfirm) {
                showMessage('Máº­t kháº©u xÃ¡c nháº­n khÃ´ng khá»›p', 'error');
                return;
            }

            const result = await authService.register(username, password, fullName);

            if (result.success) {
                showMessage(result.message + ' Äang chuyá»ƒn sang Ä‘Äƒng nháº­p...', 'success');
                setTimeout(() => {
                    document.getElementById('registerFormElement').reset();
                    registerForm.classList.add('hidden');
                    loginForm.classList.remove('hidden');
                    document.getElementById('loginUsername').value = username;
                }, 1500);
            } else {
                showMessage(result.message, 'error');
            }
        });

        // Message functions
        function showMessage(message, type) {
            const messageEl = document.getElementById('authMessage');
            messageEl.textContent = message;
            messageEl.className = `auth-message ${type}`;
            messageEl.classList.remove('hidden');
        }

        function clearMessage() {
            document.getElementById('authMessage').classList.add('hidden');
        }
    </script>
</body>

</html>
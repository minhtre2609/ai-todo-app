<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="AI Smart To-Do List - ·ª®ng d·ª•ng qu·∫£n l√Ω c√¥ng vi·ªác th√¥ng minh v·ªõi AI ph√¢n t√≠ch m·ª©c ƒë·ªô ∆∞u ti√™n v√† g·ª£i √Ω th·ªùi gian l√†m vi·ªác hi·ªáu qu·∫£">
    <meta name="keywords" content="to-do list, task management, AI, productivity, qu·∫£n l√Ω c√¥ng vi·ªác">
    <title>AI Smart To-Do List - Qu·∫£n L√Ω C√¥ng Vi·ªác Th√¥ng Minh</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-content">
            <div class="nav-brand">
                <h2>ü§ñ AI Smart To-Do List</h2>
            </div>
            <div class="nav-menu">
                <span class="nav-user">üë§ <span id="navUserName">User</span></span>
                <a href="profile.html" class="btn btn-secondary btn-sm">üë§ Profile</a>
                <a href="admin.html" id="adminLink" class="btn btn-secondary btn-sm hidden">‚öôÔ∏è Admin</a>
                <button id="logoutBtn" class="btn btn-secondary btn-sm">üö™ ƒêƒÉng xu·∫•t</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>ü§ñ AI Smart To-Do List</h1>
            <p>Qu·∫£n l√Ω c√¥ng vi·ªác th√¥ng minh v·ªõi AI ph√¢n t√≠ch v√† t·ªëi ∆∞u hi·ªáu su·∫•t</p>
        </header>

        <!-- Task Input Section -->
        <section class="task-input-section">
            <div class="glass-card">
                <h2>üìù Th√™m C√¥ng Vi·ªác M·ªõi</h2>
                <form id="taskForm" class="input-group">
                    <div class="input-wrapper">
                        <textarea id="taskTitle" class="task-textarea"
                            placeholder="Nh·∫≠p c√¥ng vi·ªác c·∫ßn l√†m... (VD: Ho√†n th√†nh b√°o c√°o quan tr·ªçng cho s·∫øp)"
                            required></textarea>
                    </div>

                    <div class="input-row">
                        <div class="input-wrapper">
                            <label for="taskDeadline"
                                style="display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 0.9rem;">‚è∞
                                Th·ªùi h·∫°n ho√†n th√†nh (T√πy ch·ªçn)</label>
                            <input type="datetime-local" id="taskDeadline" class="task-input" style="width: 100%;">
                        </div>

                        <div class="input-wrapper">
                            <label for="taskManualPriority"
                                style="display: block; margin-bottom: 8px; color: var(--text-secondary); font-size: 0.9rem;">‚≠ê
                                M·ª©c ƒë·ªô quan tr·ªçng</label>
                            <select id="taskManualPriority" class="task-select">
                                <option value="">T√πy ch·ªçn</option>
                                <option value="critical">C·ª±c k·ª≥ quan tr·ªçng</option>
                                <option value="high">Quan tr·ªçng</option>
                                <option value="medium">Trung b√¨nh</option>
                                <option value="low">Kh√¥ng g·∫•p</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        ‚ú® Th√™m & Ph√¢n T√≠ch
                    </button>
                </form>
            </div>
        </section>

        <!-- Task List Section -->
        <section class="task-list-section">
            <div class="glass-card">
                <h2>üìã Danh S√°ch C√¥ng Vi·ªác</h2>
                <div id="tasksContainer" class="tasks-container">
                    <!-- Tasks will be inserted here dynamically -->
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <p>Ch∆∞a c√≥ c√¥ng vi·ªác n√†o. H√£y th√™m c√¥ng vi·ªác ƒë·∫ßu ti√™n!</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Analysis Section -->
        <section class="analysis-section">
            <div class="glass-card">
                <h2>üìä Ph√¢n T√≠ch Hi·ªáu Su·∫•t</h2>

                <div class="analysis-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalTasks">0</div>
                        <div class="stat-label">T·ªïng C√¥ng Vi·ªác</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-value" id="completedTasks">0</div>
                        <div class="stat-label">ƒê√£ Ho√†n Th√†nh</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-value" id="completionRate">0%</div>
                        <div class="stat-label">T·ª∑ L·ªá Ho√†n Th√†nh</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-value" id="estimatedTime">0h</div>
                        <div class="stat-label">Th·ªùi Gian C√≤n L·∫°i</div>
                    </div>
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>

                <div class="analysis-content mt-3" id="analysisContent">
                    <h3>üí° ƒê·ªÅ Xu·∫•t & Ph√¢n T√≠ch</h3>
                    <ul id="analysisList">
                        <li>B·∫Øt ƒë·∫ßu th√™m c√¥ng vi·ªác ƒë·ªÉ nh·∫≠n ƒë∆∞·ª£c ph√¢n t√≠ch t·ª´ AI</li>
                    </ul>
                </div>
            </div>
        </section>
    </div>

    <!-- Firebase Scripts (ES Modules) -->
    <script type="module" src="firebase-config.js"></script>
    <script type="module" src="firebase-auth.js"></script>
    <script type="module">
        import authService from './firebase-auth.js';

        // Prevent redirect loop
        let hasRedirected = false;

        // Wait for auth to be ready
        (async () => {
            console.log('[INDEX] Waiting for auth...');

            // Check if user just logged in
            const justLoggedIn = sessionStorage.getItem('just_logged_in');
            if (justLoggedIn) {
                console.log('[INDEX] User just logged in, clearing flag and waiting longer...');
                sessionStorage.removeItem('just_logged_in');
                // Wait extra time for Firebase auth to fully initialize
                await new Promise(resolve => setTimeout(resolve, 2000));
            }

            await authService.waitForAuth();
            console.log('[INDEX] Auth ready! Is logged in:', authService.isLoggedIn());

            // Check authentication
            if (!authService.isLoggedIn()) {
                console.log('[INDEX] Not logged in, redirecting in 1s...');
                if (!hasRedirected) {
                    hasRedirected = true;
                    setTimeout(() => {
                        console.log('[INDEX] Redirecting now');
                        window.location.href = 'login.html';
                    }, 1000);
                }
                return;
            }

            console.log('[INDEX] Logged in as:', authService.getCurrentUser()?.fullName);

            // Display user info
            const currentUser = authService.getCurrentUser();
            if (currentUser) {
                document.getElementById('navUserName').textContent = currentUser.fullName;

                // Show admin link if user is admin
                if (authService.isAdmin()) {
                    document.getElementById('adminLink').classList.remove('hidden');
                }
            }

            // Logout functionality
            document.getElementById('logoutBtn').addEventListener('click', async () => {
                await authService.logout();
                hasRedirected = true;
                window.location.href = 'login.html';
            });
        })();
    </script>
    <script type="module" src="firebase-app.js"></script>
</body>

</html>